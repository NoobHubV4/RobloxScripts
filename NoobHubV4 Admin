local CmdGui = Instance.new("ScreenGui")
local Background = Instance.new("Frame")
local CmdName = Instance.new("TextLabel")
local FindCmd = Instance.new("TextBox")
local CmdHandler = Instance.new("ScrollingFrame")
local CmdText = Instance.new("TextButton")
local UIListLayout = Instance.new("UIListLayout")
local Background2 = Instance.new("Frame")
local Label = Instance.new("TextLabel")
local Execute = Instance.new("TextBox")
local Minimum = Instance.new("TextButton")
local Close = Instance.new("TextButton")
local Background3 = Instance.new("Frame")
local Topbar = Instance.new("TextLabel")
local CmdTitle = Instance.new("TextLabel")
local Background4 = Instance.new("Frame")
local Notify6 = Instance.new("TextLabel")
local Notify5 = Instance.new("TextLabel")
local Notify4 = Instance.new("TextLabel")
local Notify3 = Instance.new("TextLabel")
local Notify2 = Instance.new("TextLabel")
local Notify1 = Instance.new("TextLabel")
local CloseBar = Instance.new("TextButton")
local TransparencyBar = Instance.new("TextButton")
local Prefix = ";"

CmdGui.Name = "CmdGui"
CmdGui.Parent = game:GetService("CoreGui")
CmdGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

Background.Name = "Background"
Background.Parent = CmdGui
Background.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Background.BorderSizePixel = 0
Background.Position = UDim2.new(0.368556708, 0, 0.11490047, 0)
Background.Size = UDim2.new(0, 350, 0, 350)
Background.Active = true
Background.Draggable = true

CmdName.Name = "CmdName"
CmdName.Parent = Background
CmdName.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
CmdName.BorderSizePixel = 0
CmdName.Size = UDim2.new(0, 350, 0, 25)
CmdName.Font = Enum.Font.GothamBlack
CmdName.Text = "Commands"
CmdName.TextColor3 = Color3.fromRGB(255, 255, 255)
CmdName.TextScaled = true
CmdName.TextSize = 14.000
CmdName.TextWrapped = true

FindCmd.Name = "FindCmd"
FindCmd.Parent = Background
FindCmd.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
FindCmd.BorderColor3 = Color3.fromRGB(0, 255, 0)
FindCmd.BorderSizePixel = 0
FindCmd.Position = UDim2.new(0.0714285746, 0, 0.0702347234, 0)
FindCmd.Size = UDim2.new(0, 300, 0, 20)
FindCmd.Font = Enum.Font.SourceSans
FindCmd.PlaceholderColor3 = Color3.fromRGB(255, 255, 255)
FindCmd.PlaceholderText = "Search For Command"
FindCmd.Text = ""
FindCmd.TextColor3 = Color3.fromRGB(255, 255, 255)
FindCmd.TextSize = 14.000
FindCmd.TextWrapped = true

CmdHandler.Name = "CmdHandler"
CmdHandler.Parent = Background
CmdHandler.Active = true
CmdHandler.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
CmdHandler.BackgroundTransparency = 1.000
CmdHandler.BorderSizePixel = 0
CmdHandler.AutomaticCanvasSize = "Y"
CmdHandler.Position = UDim2.new(0.0714285746, 0, 0.142857149, 0)
CmdHandler.Size = UDim2.new(0, 300, 0, 290)
CmdHandler.ScrollBarThickness = 2

CmdText.Name = "CmdText"
CmdText.Parent = nil
CmdText.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
CmdText.BackgroundTransparency = 1.000
CmdText.BorderSizePixel = 0
CmdText.Size = UDim2.new(0, 300, 0, 25)
CmdText.Font = Enum.Font.SourceSans
CmdText.Text = "Text"
CmdText.TextColor3 = Color3.fromRGB(255, 255, 255)
CmdText.TextScaled = true
CmdText.TextSize = 14.000
CmdText.TextWrapped = true

UIListLayout.Parent = CmdHandler
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

Minimum.Name = "Minimum"
Minimum.Parent = Background
Minimum.BackgroundColor3 = Color3.fromRGB(0, 155, 155)
Minimum.BorderSizePixel = 0
Minimum.Position = UDim2.new(0.842857122, 0, 0.00571428565, 0)
Minimum.Size = UDim2.new(0, 20, 0, 20)
Minimum.Font = Enum.Font.SourceSans
Minimum.Text = ""
Minimum.TextColor3 = Color3.fromRGB(255, 255, 255)
Minimum.TextSize = 14.000
Minimum.MouseButton1Click:Connect(function()
	if Background.BackgroundTransparency == 0 then
		Background.BackgroundTransparency = 1
		Background.Size = UDim2.new(0, 350, 0, 25)
		FindCmd.Visible = false
		CmdHandler.Visible = false
	elseif Background.BackgroundTransparency == 1 then
		Background.BackgroundTransparency = 0
		Background.Size = UDim2.new(0, 350, 0, 350)
		FindCmd.Visible = true
		CmdHandler.Visible = true
	end
end)

Close.Name = "Close"
Close.Parent = Background
Close.BackgroundColor3 = Color3.fromRGB(155, 0, 0)
Close.BorderSizePixel = 0
Close.Position = UDim2.new(0.928571403, 0, 0.00571428565, 0)
Close.Size = UDim2.new(0, 20, 0, 20)
Close.Font = Enum.Font.SourceSans
Close.Text = ""
Close.TextColor3 = Color3.fromRGB(255, 255, 255)
Close.TextSize = 14.000
Close.MouseButton1Click:Connect(function()
	Background.Visible = false
end)

-- New

Background2.Name = "Background"
Background2.Parent = CmdGui
Background2.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Background2.BorderSizePixel = 0
Background2.Position = UDim2.new(0.012, 0, 0.807, 0)
Background2.Size = UDim2.new(0, 250, 0, 80)
Background2.Active = true
Background2.Draggable = true

Label.Name = "Label"
Label.Parent = Background2
Label.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
Label.BorderSizePixel = 0
Label.Position = UDim2.new(0, 0, 0, 0)
Label.Size = UDim2.new(0, 250, 0, 25)
Label.Font = Enum.Font.GothamBlack
Label.Text = "Execute Bar"
Label.TextColor3 = Color3.fromRGB(255, 255, 255)
Label.TextScaled = true
Label.TextSize = 14.000
Label.TextWrapped = true

Execute.Name = "Execute"
Execute.Parent = Background2
Execute.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Execute.BorderColor3 = Color3.fromRGB(0, 255, 0)
Execute.Position = UDim2.new(0.097, 0, 0.436, 0)
Execute.Size = UDim2.new(0, 200, 0, 30)
Execute.Font = Enum.Font.SourceSans
Execute.PlaceholderColor3 = Color3.fromRGB(255, 255, 255)
Execute.PlaceholderText = "Press "..Prefix.." To Enter"
Execute.Text = ""
Execute.TextColor3 = Color3.fromRGB(255, 255, 255)
Execute.TextSize = 16.000
Execute.TextWrapped = true
Execute.ClearTextOnFocus = false

Background3.Name = "Background3"
Background3.Parent = CmdGui
Background3.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Background3.BorderSizePixel = 0
Background3.Position = UDim2.new(0.306701034, 0, 0.288421065, 0)
Background3.Size = UDim2.new(0, 200, 0, 100)
Background3.Active = true
Background3.Visible = false

Topbar.Name = "Topbar"
Topbar.Parent = Background3
Topbar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Topbar.BorderSizePixel = 0
Topbar.Size = UDim2.new(0, 200, 0, 25)
Topbar.Font = Enum.Font.GothamBlack
Topbar.Text = ""
Topbar.TextColor3 = Color3.fromRGB(255, 255, 255)
Topbar.TextScaled = true
Topbar.TextSize = 14.000
Topbar.TextWrapped = true

CmdTitle.Name = "CmdTitle"
CmdTitle.Parent = Background3
CmdTitle.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
CmdTitle.BackgroundTransparency = 1.000
CmdTitle.BorderSizePixel = 0
CmdTitle.Position = UDim2.new(0.0500000007, 0, 0.379999995, 0)
CmdTitle.Size = UDim2.new(0, 180, 0, 40)
CmdTitle.Font = Enum.Font.GothamBlack
CmdTitle.Text = ""
CmdTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
CmdTitle.TextSize = 14.000
CmdTitle.TextWrapped = true

Background4.Name = "Background4"
Background4.Parent = CmdGui
Background4.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Background4.BorderSizePixel = 0
Background4.Position = UDim2.new(0.0154639352, 0, 0.519107938, 0)
Background4.Size = UDim2.new(0, 250, 0, 119)
Background4.Active = true
Background4.Draggable = true

Notify6.Name = "Notify6"
Notify6.Parent = Background4
Notify6.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
Notify6.BackgroundTransparency = 1.000
Notify6.BorderSizePixel = 0
Notify6.Position = UDim2.new(0, 0, -0.00512820482, 0)
Notify6.Size = UDim2.new(0, 250, 0, 20)
Notify6.Font = Enum.Font.GothamBlack
Notify6.Text = ""
Notify6.TextColor3 = Color3.fromRGB(255, 255, 255)
Notify6.TextScaled = true
Notify6.TextSize = 14.000
Notify6.TextWrapped = true

Notify5.Name = "Notify5"
Notify5.Parent = Background4
Notify5.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
Notify5.BackgroundTransparency = 1.000
Notify5.BorderSizePixel = 0
Notify5.Position = UDim2.new(0, 0, 0.162939027, 0)
Notify5.Size = UDim2.new(0, 250, 0, 20)
Notify5.Font = Enum.Font.GothamBlack
Notify5.Text = ""
Notify5.TextColor3 = Color3.fromRGB(255, 255, 255)
Notify5.TextScaled = true
Notify5.TextSize = 14.000
Notify5.TextWrapped = true

Notify4.Name = "Notify4"
Notify4.Parent = Background4
Notify4.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
Notify4.BackgroundTransparency = 1.000
Notify4.BorderSizePixel = 0
Notify4.Position = UDim2.new(0, 0, 0.331006259, 0)
Notify4.Size = UDim2.new(0, 250, 0, 20)
Notify4.Font = Enum.Font.GothamBlack
Notify4.Text = ""
Notify4.TextColor3 = Color3.fromRGB(255, 255, 255)
Notify4.TextScaled = true
Notify4.TextSize = 14.000
Notify4.TextWrapped = true

Notify3.Name = "Notify3"
Notify3.Parent = Background4
Notify3.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
Notify3.BackgroundTransparency = 1.000
Notify3.BorderSizePixel = 0
Notify3.Position = UDim2.new(0, 0, 0.499073505, 0)
Notify3.Size = UDim2.new(0, 250, 0, 20)
Notify3.Font = Enum.Font.GothamBlack
Notify3.Text = ""
Notify3.TextColor3 = Color3.fromRGB(255, 255, 255)
Notify3.TextScaled = true
Notify3.TextSize = 14.000
Notify3.TextWrapped = true

Notify2.Name = "Notify2"
Notify2.Parent = Background4
Notify2.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
Notify2.BackgroundTransparency = 1.000
Notify2.BorderSizePixel = 0
Notify2.Position = UDim2.new(0, 0, 0.667140722, 0)
Notify2.Size = UDim2.new(0, 250, 0, 20)
Notify2.Font = Enum.Font.GothamBlack
Notify2.Text = ""
Notify2.TextColor3 = Color3.fromRGB(255, 255, 255)
Notify2.TextScaled = true
Notify2.TextSize = 14.000
Notify2.TextWrapped = true

Notify1.Name = "Notify1"
Notify1.Parent = Background4
Notify1.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
Notify1.BackgroundTransparency = 1.000
Notify1.BorderSizePixel = 0
Notify1.Position = UDim2.new(0, 0, 0.835207999, 0)
Notify1.Size = UDim2.new(0, 250, 0, 20)
Notify1.Font = Enum.Font.GothamBlack
Notify1.Text = ""
Notify1.TextColor3 = Color3.fromRGB(255, 255, 255)
Notify1.TextScaled = true
Notify1.TextSize = 14.000
Notify1.TextWrapped = true

CloseBar.Name = "CloseBar"
CloseBar.Parent = Background4
CloseBar.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
CloseBar.BorderSizePixel = 0
CloseBar.Position = UDim2.new(0.899999976, 0, -0.210084036, 0)
CloseBar.Size = UDim2.new(0, 25, 0, 25)
CloseBar.Font = Enum.Font.GothamBlack
CloseBar.Text = "X"
CloseBar.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBar.TextScaled = true
CloseBar.TextSize = 14.000
CloseBar.TextWrapped = true
CloseBar.MouseButton1Click:Connect(function()
	Background4.Visible = false
end)

TransparencyBar.Name = "TransparencyBar"
TransparencyBar.Parent = Background4
TransparencyBar.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
TransparencyBar.BorderSizePixel = 0
TransparencyBar.Position = UDim2.new(0.799999952, 0, -0.210084036, 0)
TransparencyBar.Size = UDim2.new(0, 25, 0, 25)
TransparencyBar.Font = Enum.Font.GothamBlack
TransparencyBar.Text = "="
TransparencyBar.TextColor3 = Color3.fromRGB(255, 255, 255)
TransparencyBar.TextScaled = true
TransparencyBar.TextSize = 14.000
TransparencyBar.TextWrapped = true
TransparencyBar.MouseButton1Click:Connect(function()
	if TransparencyBar.Text == "=" then
		Background4.BackgroundTransparency = 0.750
		CloseBar.BackgroundTransparency = 0.750
		TransparencyBar.BackgroundTransparency = 0.750
		TransparencyBar.Text = "+"
	else
		Background4.BackgroundTransparency = 0.000
		CloseBar.BackgroundTransparency = 0.000
		TransparencyBar.BackgroundTransparency = 0.000
		TransparencyBar.Text = "="
	end
end)

local UseCommand = false
local Cmd = {}

Cmd[#Cmd + 1] = {Text = "versions 1",Title = "Script versions"}
Cmd[#Cmd + 1] = {Text = "commands / command / cmds / cmd",Title = "Show Commands list"}
Cmd[#Cmd + 1] = {Text = "autorespawn / autore / autorefresh [on/off]",Title = "Toggles autorespawn to true or false"}
Cmd[#Cmd + 1] = {Text = "kill [plr]",Title = "Kill Player"}
Cmd[#Cmd + 1] = {Text = "killinmates / killinmate",Title = "Kill All Inmates"}
Cmd[#Cmd + 1] = {Text = "killguards / killguard",Title = "Kill All Guards"}
Cmd[#Cmd + 1] = {Text = "killcriminals / killcriminals",Title = "Kill All Criminals"}
Cmd[#Cmd + 1] = {Text = "re / ref / refresh",Title = "Refreshes Character"}
Cmd[#Cmd + 1] = {Text = "res / respawn",Title = "Respawn Character"}
Cmd[#Cmd + 1] = {Text = "inmate / in",Title = "Change Team Inmate"}
Cmd[#Cmd + 1] = {Text = "guard / gu",Title = "Change Team Guard"}
Cmd[#Cmd + 1] = {Text = "criminal / crim / makecrim [plr]",Title = "Make Player Criminal"}
Cmd[#Cmd + 1] = {Text = "remington / shotgun",Title = "Get Remington 870"}
Cmd[#Cmd + 1] = {Text = "ak-47 / ak",Title = "Get AK-47"}
Cmd[#Cmd + 1] = {Text = "m9",Title = "Get M9"}
Cmd[#Cmd + 1] = {Text = "guns / gun",Title = "Get All Guns"}
Cmd[#Cmd + 1] = {Text = "loopkillall",Title = "Loopkill All"}
Cmd[#Cmd + 1] = {Text = "loopkillinmate / loopkillinmates",Title = "Loopkill Inmates"}
Cmd[#Cmd + 1] = {Text = "loopkillguard / loopkillguards",Title = "Loopkill Guards"}
Cmd[#Cmd + 1] = {Text = "loopkillcriminal / loopkillcriminals",Title = "Loopkill Criminals"}
Cmd[#Cmd + 1] = {Text = "unloopkillall",Title = "Stopped loopkill all"}
Cmd[#Cmd + 1] = {Text = "unloopkillinmate / unloopkillinmates",Title = "Stopped loopkill inmates"}
Cmd[#Cmd + 1] = {Text = "unloopkillguard / unloopkillguards",Title = "Stopped loopkill guards"}
Cmd[#Cmd + 1] = {Text = "unloopkillcriminal / unloopkillcriminals",Title = "Stopped loopkill criminals"}
Cmd[#Cmd + 1] = {Text = "autoguns / aguns [on/off]",Title = "Toggles autoguns to true or false"}
Cmd[#Cmd + 1] = {Text = "loopkill [plr]",Title = "Loopkill Player"}
Cmd[#Cmd + 1] = {Text = "unloopkill [plr]",Title = "Unloopkill Player"}

local Material = {}
local Toggles = {AutoRespawn = false; AutoGuns = nil}
local SavedPositions = {AutoRe = nil; Crimpad = workspace["Criminals Spawn"].SpawnLocation.CFrame}
local Connections = {Died = nil}
local Camera = game:FindService("Workspace").CurrentCamera
local Rservice = game:GetService("RunService")
local Hbeat = Rservice.Heartbeat
local Rstep = Rservice.RenderStepped
local Stepped = Rservice.Stepped
local Players = game.Players
local LocalPlayer = Players.localPlayer
local Teams = game.Teams
local Rstorage = game.ReplicatedStorage
local Whitelisted = {}
local States = {}
local SavedArgs = {}
local Loops = {Kill = {}, KillTeams = {All = false, Inmate = false, Guard = false, Criminal = false}}
local Saved = {}

local Mouse = game.Players.LocalPlayer:GetMouse()

for i = 1,#Cmd do
	local clone = CmdText:Clone()
	clone.Text = Cmd[i].Text
	clone.Name = "COMMANDS"
	local Ins = Instance.new("StringValue", clone)
	Ins.Name = "Title"
	Ins.Value = Cmd[i].Title
	local Ins2 = Instance.new("StringValue", clone)
	Ins2.Name = "TopbarName"
	Ins2.Value = Cmd[i].Text:split(" ")[1]
	clone.Parent = CmdHandler
	clone.MouseButton1Click:Connect(function()
		Execute:CaptureFocus()
		Execute.Text = clone.Text:split(" ")[1]
		Execute.CursorPosition = #Execute.Text + 1
	end)
end

Mouse.Move:Connect(function()
	local Guis = game:GetService("CoreGui"):GetGuiObjectsAtPosition(Mouse.X, Mouse.Y)
	local Gui
	for i,v in pairs(Guis) do
		if v.Parent == CmdHandler then
			Gui = v
		end
	end
	if Gui ~= nil then
		local PositionX
		local PositionY
		local X = Mouse.X
		local Y = Mouse.Y
		if Mouse.X > 200 then
			PositionX = Mouse.X - 201
		else
			PositionX = Mouse.X + 21
		end
		if Mouse.Y > (Mouse.ViewSizeY-96) then
			PositionY = Mouse.Y - 97
		else
			PositionY = Mouse.Y
		end
		Background3.Visible = true
		Background3.Position = UDim2.new(0, PositionX, 0, PositionY)
		Topbar.Text = Gui.TopbarName.Value
		CmdTitle.Text = Gui.Title.Value
	else
		Background3.Visible = false
	end
end)

if DisableScript then
	DisableScript()
end

local function Notify(Message, Color, Text)
	Notify6.Text = Notify5.Text
	Notify6.TextColor3 = Notify5.TextColor3
	Notify5.Text = Notify4.Text
	Notify5.TextColor3 = Notify4.TextColor3
	Notify4.Text = Notify3.Text
	Notify4.TextColor3 = Notify3.TextColor3
	Notify3.Text = Notify2.Text
	Notify3.TextColor3 = Notify2.TextColor3
	Notify2.Text = Notify1.Text
	Notify2.TextColor3 = Notify1.TextColor3
	Notify1.Text = "["..Text.."] "..Message
	Notify1.TextColor3 = Color or Color3.fromRGB(255, 255, 255)
end

local Gun = function(args) 
	workspace.Remote.ItemHandler:InvokeServer({Position = LocalPlayer.Character.Head.Position, Parent = workspace.Prison_ITEMS.giver:FindFirstChild(args) or workspace.Prison_ITEMS.single:FindFirstChild(args)})
end

function AllGuns()
    task.spawn(Gun, "AK-47")
    task.spawn(Gun, "Remington 870")
    task.spawn(Gun, "M9")
end

function CheckWhitelist(arg)
    return not (Whitelisted[arg.UserId])
end

local PlrFromArgs = function(plr, args)
	if plr and plr:lower() == "me" then
		return args
	elseif not plr and not args then
		return false
	elseif not plr and args then
		return args
	end
	local foundplr = false
	for i,v in pairs(Players:GetPlayers()) do
		local Name, DisplayName = v.Name:lower(), v.DisplayName:lower()
		if Name:sub(1, #plr) == plr:lower() or DisplayName:sub(1, #plr) == plr:lower() then
			foundplr = v
		end
	end
	return foundplr
end

local LAction = function(args, args2)
	if args == "sit" then
		LocalPlayer.Character:FindFirstChild("Humanoid").Sit = true
	elseif args == "unsit" then
		if args2 then
			local human = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
			for i = 1, 8 do Hbeat:Wait();human.Sit=false;Rstep:Wait();human.Sit=false;Stepped:Wait();human.Sit=false end
		end;LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState(Enum.HumanoidStateType.Running)
	elseif args == "speed" then
		LocalPlayer.Character:FindFirstChild("Humanoid").WalkSpeed = args2
	elseif args == "jumppw" then
		LocalPlayer.Character:FindFirstChild("Humanoid").JumpPower = args2
	elseif args == "die" then
		LocalPlayer.Character:FindFirstChild("Humanoid").Health = 0
	elseif args == "died" then
		LocalPlayer.Character:FindFirstChildWhichIsA("Humanoid"):ChangeState(Enum.HumanoidStateType.Dead)
	elseif args == "jump" then
		LocalPlayer.Character:FindFirstChild("Humanoid"):ChangeState(Enum.HumanoidStateType.Jumping)
	elseif args == "state" then
		LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState(args2)
	elseif args == "equip" then
		LocalPlayer.Character:FindFirstChild("Humanoid"):EquipTool(args2)
	elseif args == "unequip" then
		LocalPlayer.Character:FindFirstChild("Humanoid"):UnequipTools()
	end
end

local CPing = function(ConvertToHuman, OneWayTrip)
	if ConvertToHuman then
		return OneWayTrip and LocalPlayer:GetNetworkPing() * 1000 or game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue()
	else
		return OneWayTrip and LocalPlayer:GetNetworkPing() or game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue() / 1000
	end
end

local LocTP = function(cframe)
	LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame = cframe
end

function SaveCamPos()
	SavedPositions.OldCameraPos = Camera.CFrame
end
function LoadCamPos()
	Rstep:Wait()
	Camera.CFrame = SavedPositions.OldCameraPos or Camera.CFrame
end

function TeamEve(args)
  workspace.Remote.TeamEvent:FireServer(args)
end

local TeamTo = function(args)
	local tempos = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame; SavedPositions.AutoRe = tempos; SaveCamPos()
	if args == "criminal" then
        if LocalPlayer.TeamColor.Name == "Medium stone grey" then
               TeamEve("Bright orange")
               LocalPlayer.CharacterAdded:Wait()
        end
			workspace["Criminals Spawn"].SpawnLocation.CanCollide = false
			workspace["Criminals Spawn"].SpawnLocation.CFrame = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
			repeat task.wait()
				pcall(function()
					workspace["Criminals Spawn"].SpawnLocation.CFrame = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
				end)
			until LocalPlayer.TeamColor == BrickColor.new("Really red"); workspace['Criminals Spawn'].SpawnLocation.CFrame = SavedPositions.Crimpad
            return
	elseif args == "inmate" then
		TeamEve("Bright orange")
	elseif args == "guard" then
		TeamEve("Bright blue")
		if #Teams.Guards:GetPlayers() > 7 then
			return
		end
	end
	LocalPlayer.CharacterAdded:Wait(); waitfor(LocalPlayer.Character, "HumanoidRootPart", 5).CFrame = tempos; LoadCamPos()
end

local waitfor = function(source, args, interval)
	local int = interval or 5
	local timeout = tick() + int
	repeat Stepped:Wait() until source:FindFirstChild(args) or tick() - timeout >=0
	timeout = nil
	if source:FindFirstChild(args) then
		return source:FindFirstChild(args)
	else
		return nil
	end
end

function Refresh(RefreshAs, Position)
    if RefreshAs then
			LocalPlayer.TeamColor = BrickColor.new(RefreshAs)
		end
		local tmp = Position or LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame; SavedPositions.AutoRe = tmp; SaveCamPos()
		if LocalPlayer.TeamColor == BrickColor.new("Bright blue") then
			if #Teams.Guards:GetPlayers() > 7 then
				TeamEve("Bright orange")
			end; TeamEve("Bright blue")
		elseif LocalPlayer.TeamColor == BrickColor.new("Bright orange") then
			TeamEve("Bright orange")
		elseif LocalPlayer.TeamColor == BrickColor.new("Really red") then
			TeamEve("Bright orange")
			task.spawn(function()
				workspace['Criminals Spawn'].SpawnLocation.CFrame = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame; LocalPlayer.CharacterAdded:Wait()
				repeat Stepped:Wait()
					pcall(function()
						workspace["Criminals Spawn"].SpawnLocation.CFrame = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
					end)
				until LocalPlayer.TeamColor == BrickColor.new("Really red"); workspace['Criminals Spawn'].SpawnLocation.CFrame = SavedPositions.Crimpad
			end)
		else
			TeamEve("Medium stone grey")
		end; LocalPlayer.CharacterAdded:Wait()
		if waitfor(LocalPlayer.Character, "HumanoidRootPart", 5) then
			LocTP(tmp)
		end; LoadCamPos()
end

function Respawn(bcolor)
		SavedPositions.AutoRe = nil
		if bcolor == BrickColor.new("Bright orange") then
			TeamEve("Bright orange")
		elseif bcolor == BrickColor.new("Bright blue") then
			TeamEve("Bright orange")
			TeamEve("Bright blue")
		elseif bcolor == BrickColor.new("Really red") then
			task.spawn(TeamEve, "Bright orange")
            LocalPlayer.CharacterAdded:Wait()
			TeamEve("Bright blue")
			repeat Stepped:Wait()
				pcall(function()
					LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame = workspace["Criminals Spawn"].SpawnLocation.CFrame
				end)
			until LocalPlayer.TeamColor == BrickColor.new("Really red")
		else
			TeamEve("Medium stone grey")
		end
end

local ArrestEve = function(args, repeated, interval)
	if repeated then
		for i = 1, repeated do
			if interval then task.wait(interval) end
			task.spawn(function()
				if args.Character:FindFirstChild("Humanoid") and args.Character:FindFirstChildOfClass("Humanoid").Health ~= 0 then
					workspace.Remote.arrest:InvokeServer(args.Character:FindFirstChildWhichIsA("Part"))
				end
			end)
		end
	else
		workspace.Remote.arrest:InvokeServer(args.Character:FindFirstChildWhichIsA("Part"))
	end
end

local RTPing = function(value)
	if value then
		task.wait(value)
	end
	local RT1 = tick()
	pcall(function()
		workspace.Remote.ItemHandler:InvokeServer(workspace.Prison_ITEMS.buttons["Car Spawner"]["Car Spawner"])
	end)
	local RT2 = tick()
	local RoundTrip = (RT2-RT1) * 1000
	return RoundTrip
end

local KillPL = function(plr, events, guntouse, WaitToDie) 
	local AK = LocalPlayer.Backpack:FindFirstChild("AK-47") or LocalPlayer.Character:FindFirstChild("AK-47")
	if not AK and not guntouse then
		Gun("AK-47")
		task.wait()
		AK = LocalPlayer.Backpack:FindFirstChild("AK-47") or LocalPlayer.Character:FindFirstChild("AK-47")
	elseif guntouse then
		AK = LocalPlayer.Backpack:FindFirstChild(guntouse) or LocalPlayer.Character:FindFirstChild(guntouse)
		if not AK then
			Gun(guntouse)
			task.wait()
			AK = LocalPlayer.Backpack:FindFirstChild(guntouse)
		end
	end
	if plr.Character:FindFirstChild("Humanoid").Health == 0 or plr.Character:FindFirstChildWhichIsA("ForceField") then
		return
	end
	local Eve = events or 10
	local ShootEvents = {};
	for i = 1, Eve do
		ShootEvents[#ShootEvents + 1] = {
			Hit = plr.Character:FindFirstChildOfClass("Part");
			Cframe = CFrame.new();
			RayObject = Ray.new(Vector3.new(), Vector3.new());
			Distance = 0;
		};
	end
	task.spawn(function()
		for i = 1, 5 do
			Rstorage.ReloadEvent:FireServer(AK)
			task.wait(.005)
		end
	end)
	if plr.TeamColor == LocalPlayer.TeamColor then
		if plr.TeamColor == BrickColor.new("Really red") or plr.TeamColor == BrickColor.new("Bright blue") then
			SavedPositions.AutoRe = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
			SaveCamPos()
			TeamEve("Bright orange")
			Rstorage.ShootEvent:FireServer(ShootEvents, AK)
			task.wait(0.03)
		else
			TeamTo("criminal")
			Rstorage.ShootEvent:FireServer(ShootEvents, AK)
		end
	else
		Rstorage.ShootEvent:FireServer(ShootEvents, AK)
	end
	if WaitToDie then
		repeat task.wait() until not plr.Character or not plr.Character:FindFirstChildOfClass("Humanoid") or plr.Character:FindFirstChildOfClass("Humanoid").Health == 0 or plr.Character:FindFirstChildWhichIsA("ForceField")
	end
end

local MultiKill = function(plrs, bullet, exclude)
	local AK = LocalPlayer.Backpack:FindFirstChild("AK-47") or LocalPlayer.Character:FindFirstChild("AK-47")
	if not AK and not (LocalPlayer.TeamColor == BrickColor.new("Bright blue")) then
		Gun("AK-47")
		task.wait()
		AK = LocalPlayer.Backpack:FindFirstChild("AK-47") or LocalPlayer.Character:FindFirstChild("AK-47")
	elseif LocalPlayer.TeamColor == BrickColor.new("Bright blue") then
		AK = LocalPlayer.Backpack:FindFirstChild("M9") or LocalPlayer.Character:FindFirstChild("M9")
	end
	local neutralkill, hasplayers = nil, nil
    local wascriminal = LocalPlayer.TeamColor.Name == "Really red"
    local Eve = bullet or 10
	local ShootEvents = {}
	for i,v in pairs(plrs:GetPlayers()) do
		if not (v == LocalPlayer or v == exclude) and CheckWhitelist(v) then
			if v.Character and not v.Character:FindFirstChildWhichIsA("ForceField") and not (v.Character:FindFirstChild("Humanoid").Health == 0) then
				hasplayers = true
				if v.TeamColor == LocalPlayer.TeamColor then
					if v.TeamColor == BrickColor.new("Bright orange") then
						TeamTo("criminal")
					elseif v.TeamColor == BrickColor.new("Really red") or v.TeamColor == BrickColor.new("Bright blue") then
						neutralkill = true
					end
				end
				for i = 1, Eve do
					ShootEvents[#ShootEvents + 1] = {
						Hit = v.Character:FindFirstChildOfClass("Part");
						Cframe = CFrame.new();
						RayObject = Ray.new(Vector3.new(), Vector3.new());
						Distance = 0;
					}
				end
			end
		end
	end
	if not hasplayers then
		return
	end
	task.spawn(function()
		for i = 1, 20 do
			Rstorage.ReloadEvent:FireServer(AK)
			task.wait(.005)
		end
	end)
	if neutralkill then
		SavedPositions.AutoRe = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
		SaveCamPos()
		TeamEve("Medium stone grey")
		Rstorage.ShootEvent:FireServer(ShootEvents, AK)
		task.wait(0.01)
		TeamEve("Bright orange")
	else
		Rstorage.ShootEvent:FireServer(ShootEvents, AK)
	end
end
local BringPL = function(BringFrom, Destination, isCFrame, donotusecar, dontbreakyet)
	if BringFrom.TeamColor == BrickColor.new("Medium stone grey") or not (BringFrom.Character and BringFrom.Character:FindFirstChildOfClass("Humanoid") and BringFrom.Character:FindFirstChildOfClass("Humanoid").Health ~= 0) then
		Notify("Cannot bring this player. Either dead or is in neutrals team.", Color3.fromRGB(255, 0, 0), "Error")
		return
	end; if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid").Sit then LAction("unsit", true); end
	local Car = nil; local CarButton = workspace.Prison_ITEMS.buttons["Car Spawner"]["Car Spawner"]; local ButtonPivot = CarButton:GetPivot()
	if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
		local LastPos = LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
		if not (BringFrom == LocalPlayer) then
			repeat task.wait()
				for i,v in pairs(workspace.CarContainer:GetChildren()) do
					if v:IsA("Model") and v:FindFirstChild("Body") and v.Body:FindFirstChild("VehicleSeat") and v.Name ~= "DONOTUSECAR" and not v.Body.VehicleSeat.Occupant then
						for ii,vv in pairs(v.Body:GetChildren()) do
							if vv:IsA("Seat") and not vv.Occupant then
								Car = v
								break
							end
						end
						if Car then
							break
						end
					end
				end
				if not Car then
					coroutine.wrap(function()
						LocTP(ButtonPivot)
						workspace.Remote.ItemHandler:InvokeServer(CarButton)
					end)()
				end
			until Car
			if donotusecar then Car.Name = "DONOTUSECAR"; end
			if Car and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and BringFrom.Character and BringFrom.Character:FindFirstChild("Torso") and BringFrom.Character:FindFirstChildOfClass("Humanoid") then
				repeat task.wait() until Car:FindFirstChild("RWD") and Car:FindFirstChild("Body") and Car:FindFirstChild("Body"):FindFirstChild("VehicleSeat"); States.IsBringing = true
				local seattimeout = tick() + 8
				local LHuman, LRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid"), LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
				repeat task.wait()
					LHuman = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid"); LRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
					if LHuman and LRoot then
						LRoot.CFrame = CFrame.new(Car.Body.VehicleSeat.Position); Car.Body.VehicleSeat:Sit(LHuman)
					end
				until LHuman.Sit or tick() - seattimeout >=0; seattimeout = nil
				if not LHuman or not LHuman.Sit then
					Notify("This seat is either bugged or ping lag!", Color3.fromRGB(255, 0, 0), "Error"); LAction("unsit", true)
					States.IsBringing = false; LocTP(LastPos); Car.Name = "DONOTUSECAR"
					return
				end; if BringFrom.TeamColor == BrickColor.new("Medium stone grey") then
					Notify("Player is in neutrals, bring cancelled.", Color3.fromRGB(255, 0, 0), "Error"); LAction("unsit", true)
					States.IsBringing = false; LocTP(LastPos)
					return
				end
				local TargetSeat = nil
				for i,v in pairs(Car.Body:GetChildren()) do
					if v:IsA("Seat") and not v.Occupant then
						TargetSeat = v
						break
					end
				end; if not TargetSeat then
					Notify("The car seats are too full!", Color3.fromRGB(255, 0, 0), "Error"); LocTP(LastPos)
					return
				end
				local VChar = BringFrom.Character
				local VHuman = VChar and VChar:FindFirstChildOfClass("Humanoid")
				local VRoot = VChar and VChar:FindFirstChild("HumanoidRootPart")
				local Timeout = tick() + 17
				local CarSpin, SpinRad = false, 0
				task.spawn(function()
					Car.PrimaryPart = TargetSeat; Car:SetPrimaryPartCFrame(VRoot.CFrame * CFrame.new(0, -0.3, 0))
					task.wait(4); CarSpin = true
				end)
				repeat 
					task.wait()
					local step1 = CPing() / 2 / 2 / 2
					if TargetSeat.Occupant and not VHuman.Sit then
						for i,v in pairs(Car.Body:GetChildren()) do
							if v:IsA("Seat") and not v.Occupant then
								TargetSeat = v
								break
							end
						end
					end
					Car.PrimaryPart = TargetSeat
					local Movement = Vector3.new(VRoot.Velocity.X, 0, VRoot.Velocity.Z)
					local Predict = (VRoot.CFrame - (Vector3.new(0, 0, -0.1) * step1)) + (Movement * (step1 * 28))
					if Predict.Position.Y > 1 then
						if CarSpin then
							SpinRad += 30
							Car:SetPrimaryPartCFrame(Predict * CFrame.Angles(0, math.rad(SpinRad), 0))
						else
							Car:SetPrimaryPartCFrame(Predict)
						end
					else
						Car:SetPrimaryPartCFrame(LastPos)
					end
					if BringFrom.TeamColor == BrickColor.new("Medium stone grey") then
						break
					end
				until not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChildOfClass("Humanoid") or not BringFrom.Character or not LHuman.Sit or VChar ~= BringFrom.Character or VHuman.Sit or VHuman.Health == 0 or tick() - Timeout >=0
				Timeout = nil
				if VHuman and not VHuman.Sit then
					Notify("Failed to bring!", Color3.fromRGB(255, 0, 0), "Error"); LAction("unsit", true); LocTP(LastPos); States.IsBringing = false
					return
				end
				if isCFrame then
					Car.PrimaryPart = Car:FindFirstChild("RWD"); Car:SetPrimaryPartCFrame(Destination)
				else
					Car.PrimaryPart = Car:FindFirstChild("RWD")
					local Destiny = Destination ~= LocalPlayer and Destination.Character:FindFirstChild("HumanoidRootPart").CFrame or LastPos
					Car:SetPrimaryPartCFrame(Destiny)
					if Destination ~= LocalPlayer and (donotusecar) then
						wait(.2); LAction("unsit", true); LocTP(LastPos)
					end
				end; SavedArgs.BringSuccess = true
			end
		else
			if isCFrame then
				LocTP(Destination)
			else
				LocTP(Destination.Character:FindFirstChild("HumanoidRootPart").CFrame)
			end
		end
	end
end
local MakeCrim = function(args, savepos, tpback, ArrestLater)
	if args.TeamColor == BrickColor.new("Really red") then
		Notify("Player is already criminal!", Color3.fromRGB(0, 255, 0), "Error")
	else
		if args == LocalPlayer then 
			TeamTo("criminal") 
			return 
		end; SavedPositions.MakeCrimPos = savepos and LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame or nil; SavedPositions.MakeCrimPlr = args.Character:FindFirstChild("HumanoidRootPart").CFrame
		local timeout = tick() + 10
		repeat
			BringPL(args, CFrame.new(-920.947937, 92.3143158, 2138.05615, 0.997869313, 4.71007233e-08, 0.0652444065, -4.59519711e-08, 1, -1.91075955e-08, -0.0652444065, 1.6068773e-08, 0.997869313), true, nil, true)
			RTPing(0);RTPing(0)
		until args.TeamColor == BrickColor.new("Really red") or tick() - timeout >= 0; timeout = nil
		if ArrestLater then
			ArrestPL(args)
		end;if tpback then
			BringPL(args, SavedPositions.MakeCrimPlr, true); wait(.2)
		end;if savepos then
			if LocalPlayer.Character:FindFirstChildOfClass("Humanoid").Sit then
				LAction("unsit", true)
			end;LocTP(SavedPositions.MakeCrimPos)
		end
	end
end
local chatdebounce = false
function PlayerChatted(Message)
	if ScriptDisabled then return end
	local args = Message:split(" ")
    function Command(Cmd)
           return args[1] == Prefix..Cmd
    end
    if Command("cmd") or Command("cmds") or Command("commands") or Command("command") then
           if Background.Visible == true then
			Background.Visible = false
		else
			Background.Visible = true
		end
		Notify("Showed Commands", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("autorespawn") or Command("autore") or Command("autorefresh") then
        if args[2] == "on" then
            Toggles.AutoRespawn = true
        elseif args[2] == "off" then
            Toggles.AutoRespawn = false
        else
            Toggles.AutoRespawn = not Toggles.AutoRespawn
        end
        Notify("Auto Respawn changed to "..tostring(Toggles.AutoRespawn), Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("killall") then
        MultiKill(Players)
        Notify("Kill All Players", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("killinmates") or Command("killinmate") then
        MultiKill(game.Teams.Inmates)
        Notify("Kill All Inmates", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("killguards") or Command("killguard") then
        MultiKill(game.Teams.Guards)
        Notify("Kill All Guards", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("killcriminals") or Command("killcriminal") then
        MultiKill(game.Teams.Criminals)
        Notify("Kill All Criminals", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("kill") then
        local DaPlayer = PlrFromArgs(args[2], false)
        if DaPlayer then
               KillPL(DaPlayer)
               Notify("Kill "..DaPlayer.DisplayName, Color3.fromRGB(0, 255, 0), "Success")
        elseif not DaPlayer then
               Notify("Not Player in server or player left", Color3.fromRGB(255, 0, 0), "Error")
        end
    elseif Command("re") or Command("ref") or Command("refresh") then
               Refresh()
               Notify("Refresh Your Character", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("res") or Command("respawn") then
               Respawn(LocalPlayer.TeamColor)
               Notify("Respawn Your Character", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("inmate") or Command("in") then
               TeamTo("inmate")
               Notify("Change Team Inmate", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("guard") or Command("gu") then
               TeamTo("guard")
               Notify("Change Team Guard", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("criminal") or Command("crim") or Command("makecrim") then
               local DaPlayer = PlrFromArgs(args[2], LocalPlayer)
               if DaPlayer then
                      MakeCrim(DaPlayer, true, true, false)
                      Notify("Make "..DaPlayer.DisplayName.." Crim", Color3.fromRGB(0, 255, 0), "Success")
               elseif not DaPlayer then
                      Notify("Not Player in server or player left", Color3.fromRGB(255, 0, 0), "Error")
               end
    elseif Command("ak-47") or Command("ak") then
               Gun("AK-47")
               Notify("Get Ak-47", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("remington") or Command("shotgun") then
               Gun("Remington 870")
               Notify("Get Remington 870", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("m9") then
               Gun("M9")
               Notify("Get M9", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("guns") or Command("gun") then
               AllGuns()
               Notify("Get All Guns", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("loopkillall") then
               Loops.KillTeams.All = true
               Notify("Loopkill all", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("loopkillinmate") or Command("loopkillinmates") then
               Loops.KillTeams.Inmates = true
               Notify("Loopkill inmates", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("loopkillguard") or Command("loopkillguards") then
               Loops.KillTeams.Guards = true
               Notify("Loopkill guards", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("loopkillcriminal") or Command("loopkillcriminals") then
               Loops.KillTeams.Criminals = true
               Notify("Loopkill criminals", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("unloopkillall") then
               Loops.KillTeams.All = false
               Notify("Unloopkill all", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("unloopkillinmate") or Command("unloopkillinmates") then
               Loops.KillTeams.Inmates = false
               Notify("Unloopkill inmates", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("unloopkillguard") or Command("unloopkillguards") then
               Loops.KillTeams.Guards = false
               Notify("Unloopkill guards", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("unloopkillcriminal") or Command("unloopkillcriminals") then
               Loops.KillTeams.Criminals = false
               Notify("Unloopkill criminals", Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("autoguns") or Command("aguns") then
        if args[2] == "on" then
            Toggles.AutoGuns = true
        elseif args[2] == "off" then
            Toggles.AutoGuns = false
        else
            Toggles.AutoGuns = not Toggles.AutoGuns
        end
        Notify("Auto Guns changed to "..tostring(Toggles.AutoGuns), Color3.fromRGB(0, 255, 0), "Success")
    elseif Command("loopkill") then
        local DaPlayer = PlrFromArgs(args[2], false)
        if DaPlayer then
            Loops.Kill[DaPlayer.UserId] = DaPlayer
            Notify("Loopkill "..DaPlayer.DisplayName, Color3.fromRGB(0, 255, 0), "Success")
        elseif not DaPlayer then
            Notify("Not Player in server or player left", Color3.fromRGB(255, 0, 0), "Error")
        end
    elseif Command("loopkill") then
        local DaPlayer = PlrFromArgs(args[2], false)
        if DaPlayer then
            Loops.Kill[DaPlayer.UserId] = nil
            Notify("Unloopkill "..DaPlayer.DisplayName, Color3.fromRGB(0, 255, 0), "Success")
        elseif not DaPlayer then
            Notify("Not Player in server or player left", Color3.fromRGB(255, 0, 0), "Error")
        end
    else
        Notify("Not a command list", Color3.fromRGB(255, 0, 0), "Error")
    end
end
LocalPlayer.Chatted:Connect(function(t)
	if not chatdebounce then
		chatdebounce = true
		local success, errors = pcall(function()
			PlayerChatted(t)
		end); if not success then
			--
		end
		task.wait(.5); chatdebounce = nil
	end
end)
local lochar = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local function ondiedevent()
	coroutine.wrap(function()
		Connections.Died:Disconnect(); SaveCamPos()
		SavedPositions.AutoRe = lochar:WaitForChild("HumanoidRootPart", 1) and LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame; Camera.CameraType = Enum.CameraType.Track
    if Toggles.AutoRespawn then
        local locteam = LocalPlayer.TeamColor
		if locteam == BrickColor.new("Really red") then
			if #Teams.Guards:GetPlayers() < 8 then
				TeamEve("Bright blue")
			else
				TeamEve("Bright orange")
			end
			workspace["Criminals Spawn"].SpawnLocation.CanCollide = false
			workspace["Criminals Spawn"].SpawnLocation.CFrame = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
			LocalPlayer.CharacterAdded:Wait()
			repeat task.wait()
				pcall(function()
					workspace["Criminals Spawn"].SpawnLocation.CFrame = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
				end)
			until LocalPlayer.TeamColor == BrickColor.new("Really red"); workspace['Criminals Spawn'].SpawnLocation.CFrame = SavedPositions.Crimpad
		elseif locteam == BrickColor.new("Bright blue") then
			if #Teams.Guards:GetPlayers() == 8 then
				TeamEve("Bright orange")
			end; TeamEve("Bright blue")
		elseif locteam == BrickColor.new("Bright orange") then
			TeamEve("Bright orange")
		else
			TeamEve("Medium stone grey")
		end
    end
	end)()
end
getfenv()["\112\114\105\110\116"]("\70\73\88\69\68\32\66\89\32\72\49\55\83\51") 
local function charaddtask()
	Connections.Died:Disconnect()
	local LHuman = lochar:WaitForChild("Humanoid", 1)
	if LHuman then
		Connections.Died = LHuman.Died:Connect(ondiedevent)
        if Connections.HeadChildAdded then
			Connections.HeadChildAdded:Disconnect(); Connections.HeadChildAdded = nil
		end
        Connections.HeadChildAdded = lochar.Head.ChildAdded:Connect(function(child)
               if child.Name == "handcuffedGui" and Toggles.AutoRespawn then
                      Refresh()
               end
        end)
	end
end
local function oncharadded()
	lochar = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	if SavedPositions.AutoRe and Toggles.AutoRespawn then
		local LRoot = lochar:WaitForChild("HumanoidRootPart", 1)
		if LRoot then
			LRoot.CFrame = SavedPositions.AutoRe; LoadCamPos(); LRoot.CFrame = SavedPositions.AutoRe
			task.spawn(function()
				for i = 1, 4 do
					task.wait(); LRoot.CFrame = SavedPositions.AutoRe
				end
			end)
      if game.Players.LocalPlayer.PlayerGui.Home.hud.Topbar.titleBar.Title.Text == "Lights out" then
				for i = 1, 5 do
					LRoot.CFrame = SavedPositions.AutoRe; waitfor(LocalPlayer.Character, "HumanoidRootPart", 1).CFrame = SavedPositions.AutoRe
				end; lochar:WaitForChild("HumanoidRootPart", 1).CFrame = SavedPositions.AutoRe
      end
		end
	end
	lochar:WaitForChild("Humanoid", 1):SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
	lochar:WaitForChild("Humanoid", 1):SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
  coroutine.wrap(charaddtask)()
end
Connections.Died = lochar:WaitForChild("Humanoid").Died:Connect(ondiedevent)
Connections.CharacterAdded = LocalPlayer.CharacterAdded:Connect(function(newChar)
       oncharadded()
       newChar.Head.ChildAdded:Connect(function(child)
              if child.Name == "handcuffedGui" and Toggles.AutoRespawn then
                     local wascriminal = LocalPlayer.TeamColor.Name == "Really red"
                     task.delay(4.95, function()
                            local tempos = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame; SavedPositions.AutoRe = tempos; SaveCamPos()
					        LocalPlayer.CharacterAdded:Wait(); waitfor(LocalPlayer.Character, "HumanoidRootPart", 1).CFrame = tempos; LoadCamPos()
					        if wascriminal then
						        if #Teams.Guards:GetPlayers() < 8 then
				                     TeamEve("Bright blue")
		                    	else
				                     TeamEve("Bright orange")
			                    end
			                    workspace["Criminals Spawn"].SpawnLocation.CanCollide = false
			                    workspace["Criminals Spawn"].SpawnLocation.CFrame = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
			                    LocalPlayer.CharacterAdded:Wait()
			                    repeat task.wait()
				                      pcall(function()
					                          workspace["Criminals Spawn"].SpawnLocation.CFrame = LocalPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame
				                      end)
			                    until LocalPlayer.TeamColor == BrickColor.new("Really red"); workspace['Criminals Spawn'].SpawnLocation.CFrame = SavedPositions.Crimpad
                                return
					        end
                     end)
              end
       end)
end)

Execute.FocusLost:Connect(function(enterPressed, inputObj)
	if Execute.Text == "" then
		return
	end
	if enterPressed then
		local success, errors = pcall(function()
			if string.sub(Execute.Text, 0, 1) == Prefix then
				PlayerChatted(Execute.Text)
			else
				PlayerChatted(Prefix .. Execute.Text)
			end
		end)
		if not success then
			--
		end
		task.wait(.2)
		Execute.Text = ""
	end
end)

task.spawn(function()
	local task0 = function()
		if Loops.KillTeams.All then
            Gun("AK-47")
			MultiKill(Players)
            wait(CPing(nil, true) / 2)
		else
			for i,v in next, Loops.Kill do
				if v and v.Character and not Saved.KillDebounce[v.Name] then
					if v.Character:FindFirstChild("Humanoid") and not (v.Character:FindFirstChild("Humanoid").Health == 0 or v.Character:FindFirstChildWhichIsA("ForceField")) then
						Saved.KillDebounce[v.Name] = true
						coroutine.wrap(function()
							if RTPing() then
								Saved.KillDebounce[v.Name] = nil
							end
						end)()
						KillPL(v)
					end
				end
			end
			if Loops.KillTeams.Inmates then
				if not SavedArgs.KillDebounceInmate then
					SavedArgs.KillDebounceInmate = true
					task.delay(0.015, function()
						RTPing(); SavedArgs.KillDebounceInmate = nil
					end)
					MultiKill(Teams.Inmates)
				end
			end
			if Loops.KillTeams.Guards then
				if not SavedArgs.KillDebounceGuard then
					SavedArgs.KillDebounceGuard = true
					task.delay(0.015, function()
						RTPing(); SavedArgs.KillDebounceGuard = nil
					end)
					MultiKill(Teams.Guards)
				end
			end
			if Loops.KillTeams.Criminals then
				if not SavedArgs.KillDebounceCriminal then
					SavedArgs.KillDebounceCriminal = true
					task.delay(0.015, function()
						RTPing(); SavedArgs.KillDebounceCriminal = nil
					end)
					MultiKill(Teams.Criminals)
				end
			end
		end
	end
	while task.wait() do
		pcall(task0)
	end
end)

task.spawn(function()
    function task1()
        if Toggles.AutoGuns then
            pcall(AllGuns)
        end
    end
    while task.wait() do
        pcall(task1)
    end
end)

Connections.TeamChange = LocalPlayer:GetPropertyChangedSignal("Team"):Connect(function()
    if LocalPlayer.TeamColor.Name == "Medium stone grey" then
        task.delay(0.05, function()
            game:GetService("StarterGui"):SetCoreGuiEnabled(Enum.CoreGuiType.All, true)
        end); for i = 1, 10 do
            pcall(function()
                LocalPlayer.PlayerGui.Home.intro.Visible = false; LocalPlayer.PlayerGui.Home.hud.Visible = true
                game:GetService("Workspace").CurrentCamera.FieldOfView = 70; game:GetService("Workspace").CurrentCamera.CameraType = Enum.CameraType.Custom
                game:GetService("Workspace").CurrentCamera.CameraSubject = LocalPlayer.Character:FindFirstChild("Humanoid")
            end); task.wait()
        end
    end
end)

getgenv().DisableScript = function()
	pcall(function()
		CmdGui:Destroy()
		States = {}
		LoopKill = {}
		LoopTase = {}
		Admin = {}
		ScriptDisabled = true
		for i,v in pairs(game.Lighting:GetChildren()) do
			v.Parent = workspace
		end
	end)
end

Notify("Loaded admin commands!", Color3.fromRGB(0, 255, 0), "Success")
